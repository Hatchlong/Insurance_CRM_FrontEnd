<app-side-nav (isShowNav)="handleSideBar($event)" [logoutAction]="idleState"></app-side-nav>
<div class="container-fluid " [ngStyle]="{'padding-left' : isShowPadding ? '280px' : '100px'}">
    <div class="row">
        <div class="col-12">
            <h3 class="mt-2">
                <mat-icon class="back" routerLink="/sales/delivery-list">arrow_back</mat-icon> Delivery Maintenance
            </h3>
            <form [formGroup]="deliveryFormGroup" (ngSubmit)="submitData()">

                <div class="row border">
                    <div class="col-6 py-2">
                        <label>Sales Order</label>
                        <input formControlName="salesOrderId" (typeaheadOnSelect)="typeaheadOnSelect($event)" [typeahead]="salesOrderDetails" typeaheadOptionField="salesOrder"
                            class="form-control">
                    </div>
                    <div class="col-6 mt-2">
                        <label for="">Delivery Type <sup>*</sup> </label>
                        <select class="form-select" [disabled]="true" formControlName="deliveryTypeId" [disabled]="true"
                            (change)="handleDeliveryType($event)">
                            <option [selected]="deliveryFormGroup.value.deliveryTypeId=== ''" value="" hidden>Select
                                Delivery Type</option>
                            <option *ngFor="let list of deliveryDetails" [value]="list._id">{{list.code}}</option>
                        </select>

                        <div
                            *ngIf="deliveryFormGroup.controls['deliveryTypeId'].touched && deliveryFormGroup.controls['deliveryTypeId'].touched && deliveryFormGroup.controls['deliveryTypeId'].hasError('required') && !isSubmitted">
                            <p class="error-message">Delivery Type is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['deliveryTypeId'].hasError('required')">
                            <p class="error-message">Delivery Type is mandatory</p>
                        </div>

                    </div>
                    <div class="col-6 mt-2">
                        <label for="">Plant<sup>*</sup> </label>
                        <input type="text" class="form-control" formControlName="plantName" readonly>

                        <div
                            *ngIf="deliveryFormGroup.controls['plantId'].touched && deliveryFormGroup.controls['plantId'].touched && deliveryFormGroup.controls['plantId'].hasError('required') && !isSubmitted">
                            <p class="error-message">Plant is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['plantId'].hasError('required')">
                            <p class="error-message">Plant is mandatory</p>
                        </div>

                    </div>


                    <div class="col-6 mt-2 ">
                        <label for="">Delivery Date<sup>*</sup></label>
                        <input type="date" class="form-control" formControlName="deliveryDate"
                            placeholder="Enter delivery date" readonly>

                        <div
                            *ngIf="deliveryFormGroup.controls['deliveryDate'].touched && deliveryFormGroup.controls['deliveryDate'].touched && deliveryFormGroup.controls['deliveryDate'].hasError('required') && !isSubmitted">
                            <p class="error-message">Delivery Date is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['deliveryDate'].hasError('required')">
                            <p class="error-message">Delivery Date is mandatory</p>
                        </div>

                    </div>
                    <div class="col-6 mt-2">
                        <label for="">Customer Id <sup>*</sup></label>
                        <input type="text" class="form-control" formControlName="customerName"
                            placeholder="Enter Customer Id" readonly>


                        <div
                            *ngIf="deliveryFormGroup.controls['customerId'].touched && deliveryFormGroup.controls['customerId'].touched && deliveryFormGroup.controls['customerId'].hasError('required') && !isSubmitted">
                            <p class="error-message">Customer Id Value is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['customerId'].hasError('required')">
                            <p class="error-message">Customer Id Value is mandatory</p>
                        </div>

                    </div>

                    <div class="col-6 mt-2 mb-2">
                        <label for="TaxAmount">Delivery Address <sup>*</sup></label>
                        <input type="text" class="form-control" formControlName="deliveryAddress"
                            placeholder="Enter Delivery Address" readonly>

                        <div
                            *ngIf="deliveryFormGroup.controls['deliveryAddress'].touched && deliveryFormGroup.controls['deliveryAddress'].touched && deliveryFormGroup.controls['deliveryAddress'].hasError('required') && !isSubmitted">
                            <p class="error-message">Delivery Address is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['deliveryAddress'].hasError('required')">
                            <p class="error-message">Delivery Address is mandatory</p>
                        </div>

                    </div>




                    <div class="col-6 py-2  mb-2">
                        <label for="">Delivery Partner <sup>*</sup></label>
                        <select class="form-select" [disabled]="true" formControlName="deliveryPartner">
                            <option [selected]="deliveryFormGroup.value.deliveryPartner=== ''" value="" hidden>Select
                                delivery Partner</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>

                        <div
                            *ngIf="deliveryFormGroup.controls['deliveryPartner'].touched && deliveryFormGroup.controls['deliveryPartner'].touched && deliveryFormGroup.controls['deliveryPartner'].hasError('required') && !isSubmitted">
                            <p class="error-message">Delivery Partner is mandatory</p>
                        </div>
                        <div *ngIf="isSubmitted && deliveryFormGroup.controls['deliveryPartner'].hasError('required')">
                            <p class="error-message">Delivery Partner is mandatory</p>
                        </div>

                    </div>


                </div>



                <div class="row py-2">
                    <div class="col-12 border">
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                <h3 class="mt-2 ">
                                    Item Data
                                </h3>
                            </div>

                        </div>



                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Plant</th>
                                        <th>Delivery Item</th>
                                        <th>Delivery Date</th>
                                        <th>Product Id</th>
                                        <th>Delivery QTY</th>
                                        <th>UoM</th>
                                        <th>Storage Location</th>
                                        <th>Reference sales order #</th>
                                        <th>Reference sales order item #</th>
                                    </tr>
                                </thead>

                                <tbody formArrayName="itemList">
                                    <tr *ngFor="let delivery of deliveryFormGroup.get('itemList')['controls']; let i = index;"
                                        [formGroupName]="i">

                                        <td>
                                            <input type="text" class="form-control" formControlName="plantName"
                                                readonly>
                                        </td>
                                        <td>
                                            <input type="number" class="form-control " placeholder="Enter delivery item"
                                                formControlName="deliveryItem"
                                                (input)="handleQty($event, delivery.value.deliveryQty, i)">
                                        </td>
                                        <td>
                                            <input type="date" class="form-control" formControlName="deliveryDate"
                                                placeholder="Enter delivery date">
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" formControlName="productName"
                                                readonly>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control " placeholder="Enter delivery qty"
                                                formControlName="deliveryQty" readonly>

                                        </td>
                                        <td>
                                            <select class="form-select" [disabled]="true" formControlName="uomId"
                                                (click)="handleUOM($event, i)">
                                                <option [selected]="deliveryFormGroup.value.uomId=== ''" value=""
                                                    hidden>Select UOM</option>

                                                <option *ngFor="let list of uomDetail" [value]="list._id">{{list.code}}
                                                </option>

                                            </select>

                                        </td>
                                        <td>
                                            <select class="form-select" [disabled]="true"
                                                formControlName="storageLocationName">
                                                <option [selected]="deliveryFormGroup.value.storageLocationName=== ''"
                                                    value="" hidden>Select Storage Location</option>

                                                <option *ngFor="let list of storageLocationDetail" [value]="list._id">
                                                    {{list.description}}</option>

                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" formControlName="referenceSalesOrder"
                                                class="form-control" placeholder="Enter Reference Sales Order" readonly>
                                        </td>
                                        <td>
                                            <input type="text" formControlName="referenceSalesOrderItem"
                                                class="form-control" placeholder="Enter Reference Sales Order Item"
                                                readonly>

                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row py-2">
                    <div class="col-12 d-flex justify-content-end">
                        <button class="btn btn-primary">Save</button>
                    </div>
                </div>

            </form>


        </div>
    </div>
</div>